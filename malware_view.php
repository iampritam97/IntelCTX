<?php
require_once __DIR__ . '/db.php';
include __DIR__ . '/partials/header.php';

$pdo = get_db();
$id = (int)($_GET['id'] ?? 0);

$stmt = $pdo->prepare("SELECT * FROM malware_families WHERE id = ?");
$stmt->execute([$id]);
$mal = $stmt->fetch();

if (!$mal) {
    echo "<div class='max-w-6xl mx-auto py-8 text-red-500'>Malware family not found.</div>";
    include __DIR__ . '/partials/footer.php';
    exit;
}
?>
<style>
    .apt-card {
    background: rgba(255,255,255,0.04);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 2px 6px rgba(0,0,0,0.35);
}

.section-title {
    @apply text-lg font-semibold text-ht_blue mb-2;
}

.section-body {
    @apply text-sm text-ht_muted leading-relaxed;
}

</style>
<section class="max-w-7xl mx-auto px-6 py-10 space-y-8">

    <!-- HEADER CARD -->
    <div class="apt-card p-6 rounded-xl">
        <div class="flex justify-between items-start">

            <!-- LEFT: Name + Type -->
            <div class="space-y-2">
                <h1 class="text-4xl font-extrabold text-white">
                    <?= htmlspecialchars($mal['name']) ?>
                </h1>

                <p class="text-sm text-ht_muted flex items-center gap-2">
                    <span class="px-2 py-1 rounded bg-white/10 text-white text-xs uppercase tracking-wide">
                        <?= htmlspecialchars($mal['malware_type']) ?>
                    </span>
                </p>
            </div>

            <!-- RIGHT: MITRE + Export -->
            <div class="text-right space-y-2">
                <p class="text-[10px] uppercase text-ht_muted">MITRE</p>
                <p class="text-lg font-semibold text-white">
                    <?= $mal['mitre_id'] ?: "N/A" ?>
                </p>

                <!-- <a href="export_malware_pdf.php?id=<?= $mal['id'] ?>"
                   class="inline-block text-xs px-3 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition">
                    Export PDF
                </a> -->
            </div>
        </div>
    </div>

    <!-- OVERVIEW -->
    <div class="apt-card p-6 rounded-xl">
        <h2 class="section-title">Overview</h2>
        <p class="section-body">
            <?= nl2br(htmlspecialchars($mal['description'])) ?>
        </p>
    </div>

    <!-- CAPABILITIES + BEHAVIOR -->
    <div class="grid md:grid-cols-2 gap-6">

        <div class="apt-card p-6 rounded-xl">
            <h3 class="section-title">Capabilities</h3>
            <p class="section-body whitespace-pre-line">
                <?= htmlspecialchars($mal['capabilities']); ?>
            </p>
        </div>

        <div class="apt-card p-6 rounded-xl">
            <h3 class="section-title">Behavior Summary</h3>
            <p class="section-body whitespace-pre-line">
                <?= htmlspecialchars($mal['behavior_summary']); ?>
            </p>
        </div>

    </div>

    <!-- ARTIFACTS -->
    <div class="apt-card p-6 rounded-xl">
        <h3 class="section-title">Artifacts</h3>
        <p class="section-body whitespace-pre-line">
            <?= htmlspecialchars($mal['artifacts']); ?>
        </p>
    </div>

    <!-- DETECTION -->
    <div class="apt-card p-6 rounded-xl">
        <h3 class="section-title">Detection Opportunities</h3>
        <p class="section-body whitespace-pre-line">
            <?= htmlspecialchars($mal['detection_opportunities']); ?>
        </p>
    </div>

    <!-- YARA -->
    <div class="apt-card p-6 rounded-xl">
        <h3 class="section-title">YARA Rules</h3>

        <pre class="bg-white/5 border border-white/10 rounded p-4 font-mono text-xs text-gray-300 overflow-x-auto leading-relaxed">
<?= htmlspecialchars($mal['yara_rules']); ?>
        </pre>
    </div>

    <!-- REFERENCES -->
    <div class="apt-card p-6 rounded-xl">
        <h3 class="section-title">References</h3>
        <p class="section-body whitespace-pre-line">
            <?= htmlspecialchars($mal['references_section']); ?>
        </p>
    </div>

</section>

</main>
<?php include __DIR__ . '/partials/footer.php'; ?>
